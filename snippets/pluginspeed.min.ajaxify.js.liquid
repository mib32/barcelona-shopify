function urlParams(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+a+"=([^&#]*)"),e=t.exec(location.search);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))}function floatToString(a,t){var e=a.toFixed(t).toString();return e.match(/^\.\d+/)?"0"+e:e}function attributeToString(a){return"string"!=typeof a&&"undefined"===(a+="")&&(a=""),jQuery.trim(a)}function getCookie(a){var t=document.cookie,e=t.indexOf(" "+a+"=");if(-1==e&&(e=t.indexOf(a+"=")),-1==e)t=null;else{e=t.indexOf("=",e)+1;var r=t.indexOf(";",e);-1==r&&(r=t.length),t=unescape(t.substring(e,r))}return t}"undefined"==typeof Shopify&&(Shopify={}),Shopify.formatMoney=function(a,t){function e(a){return a.replace(/(\d+)(\d{3}[\.,]?)/,"$1,$2")}"string"==typeof a&&(a=a.replace(".",""));var r="",o=/\{\{\s*(\w+)\s*\}\}/,n=t||this.money_format;switch(n.match(o)[1]){case"amount":r=e(floatToString(a/100,2));break;case"amount_no_decimals":r=e(floatToString(a/100,0));break;case"amount_with_comma_separator":r=floatToString(a/100,2).replace(/\./,",");break;case"amount_no_decimals_with_comma_separator":r=e(floatToString(a/100,0)).replace(/\./,",")}return n.replace(o,r)},Shopify.onProduct=function(){},Shopify.onCartUpdate=function(){},Shopify.updateCartNote=function(a,t){var e={type:"POST",url:"/cart/update.js",data:"note="+attributeToString(a),dataType:"json",success:function(a){"function"==typeof t?t(a):Shopify.onCartUpdate(a)},error:function(a,t){Shopify.onError(a,t)}};jQuery.ajax(e)},Shopify.onError=function(XMLHttpRequest,textStatus){var data=eval("("+XMLHttpRequest.responseText+")");data.message?alert(data.message+"("+data.status+"): "+data.description):alert("Error : "+Shopify.fullMessagesFromErrors(data).join("; ")+".")},Shopify.addItem=function(a,t,e){t=t||1;var r={type:"POST",url:"/cart/add.js",data:"quantity="+t+"&id="+a,dataType:"json",success:function(a){"function"==typeof e?e(a):Shopify.onItemAdded(a)},error:function(a,t){Shopify.onError(a,t)}};jQuery.ajax(r)},Shopify.addItemFromForm=function(a,t,e){var r={type:"POST",url:"/cart/add.js",data:jQuery(a).serialize(),dataType:"json",success:function(e){"function"==typeof t?t(e,a):Shopify.onItemAdded(e,a)},error:function(t,r){"function"==typeof e?e(t,r,a):Shopify.onError(t,r)}};jQuery.ajax(r)},Shopify.getCart=function(a){jQuery.getJSON("/cart.js",function(t){"function"==typeof a?a(t):Shopify.onCartUpdate(t)})},Shopify.getProduct=function(a,t){jQuery.getJSON("/products/"+a+".js",function(a){"function"==typeof t?t(a):Shopify.onProduct(a)})},Shopify.changeItem=function(a,t,e){var r={type:"POST",url:"/cart/change.js",data:"quantity="+t+"&line="+a,dataType:"json",success:function(a){"function"==typeof e?e(a):Shopify.onCartUpdate(a)},error:function(a,t){Shopify.onError(a,t)}};jQuery.ajax(r)};var ajaxifyShopify=function(module,$){"use strict";var init,settings,cartInit,$cssTransforms,$cssTransforms3d,$nojQueryLoad,$window,$body,$html,$pageWrapper,$wrapperClass,$formContainer,$btnClass,$windowrapperClass,$addToCart,$flipClose,$flipCart,$flipContainer,$cartCountSelector,$cartCostSelector,$drawerSelector,$toggleCartButton,$modal,$cartContainer,$modalContainer,$modalOverlay,$closeCart,$drawerContainer,$prependDrawerTo,$callbackData={},updateCountPrice,flipSetup,revertFlipButton,modalSetup,showModal,sizeModal,hideModal,drawerSetup,showDrawer,hideDrawer,loadCartImages,formOverride,itemAddedCallback,itemErrorCallback,cartUpdateCallback,setToggleButtons,flipCartUpdateCallback,buildCart,cartTemplate,adjustCart,adjustCartCallback,createQtySelectors,qtySelectors,validateQty,scrollTop,toggleCallback;return init=function(a){if(settings={method:"drawer",formSelector:'form[action^="/cart/add"]',addToCartSelector:'input[type="submit"]',cartCountSelector:null,cartCostSelector:null,drawerSelector:"#ajaxifyDrawer",toggleCartButton:null,btnClass:null,wrapperClass:null,useCartTemplate:!0,moneyFormat:"$",disableAjaxCart:!1,enableQtySelectors:!0,prependDrawerTo:"body",onToggleCallback:null,drawerExists:!1},$.extend(settings,a),urlParams("method")&&(settings.method=urlParams("method")),settings.method=settings.method.toLowerCase(),$formContainer=$(settings.formSelector),$btnClass=settings.btnClass,$wrapperClass=settings.wrapperClass,$addToCart=$formContainer.find(settings.addToCartSelector),$flipContainer=null,$flipClose=null,$cartCountSelector=$(settings.cartCountSelector),$cartCostSelector=$(settings.cartCostSelector),$drawerSelector=$(settings.drawerSelector),$toggleCartButton=$(settings.toggleCartButton),$modal=null,$prependDrawerTo=$(settings.prependDrawerTo),$cssTransforms=Modernizr.csstransforms,$cssTransforms3d=Modernizr.csstransforms3d,$window=$(window),$body=$("body"),$html=$("html"),$pageWrapper=$(".page-element"),$nojQueryLoad=$html.hasClass("lt-ie9"),$nojQueryLoad&&(settings.useCartTemplate=!1),$drawerSelector.length&&(settings.drawerExists=!0),settings.enableQtySelectors&&qtySelectors(),!settings.disableAjaxCart){switch(settings.method){case"flip":flipSetup();break;case"modal":modalSetup();break;case"drawer":drawerSetup()}$(document).keyup(function(a){if(27==a.keyCode)switch(settings.method){case"flip":case"drawer":hideDrawer();break;case"modal":hideModal()}}),$addToCart.length&&formOverride()}adjustCart()},updateCountPrice=function(a){$cartCountSelector&&($cartCountSelector.html("("+a.item_count+")").removeClass("hidden-count"),0===a.item_count&&$cartCountSelector.addClass("hidden-count")),$cartCostSelector&&$cartCostSelector.html(Shopify.formatMoney(a.total_price,settings.moneyFormat))},flipSetup=function(){if(drawerSetup(),$addToCart.length){$addToCart.addClass("flip-front").wrap('<div class="flip"></div>');var a=$('<a href="/cart" class="flip-back" style="background-color: #C00; color: #fff;" id="flip-checkout">Checkout</a>').addClass($btnClass),t=$('<span class="ajaxifyCart-loader"></span>'),e=$('<div class="flip-extra"><a href="#" class="flip-cart">View Cart (<span></span>)</a></div>');a.insertAfter($addToCart),t.insertAfter(a),$flipContainer=$(".flip"),$cssTransforms3d||$flipContainer.addClass("no-transforms"),e.insertAfter($flipContainer),$flipCart=$(".flip-cart"),$flipCart.on("click",function(a){a.preventDefault(),showDrawer(!0)}),$('input[type="checkbox"], input[type="radio"], select',$formContainer).on("click",function(){revertFlipButton()})}},revertFlipButton=function(){$flipContainer.removeClass("is-flipped")},modalSetup=function(){var a=$("#modalTemplate").html(),t=Handlebars.compile(a);$body.append(t).append('<div id="ajaxifyCart-overlay"></div>'),$modalContainer=$("#ajaxifyModal"),$modalOverlay=$("#ajaxifyCart-overlay"),$cartContainer=$("#ajaxifyCart"),$modalOverlay.on("click",hideModal),$modalContainer.prepend('<a class="ajaxifyCart--close" title="Close Cart"><span class="icon-fallback-text"><span class="icon icon-cross" aria-hidden="true"></span><span class="fallback-text">Close</span></span></a>'),$closeCart=$(".ajaxifyCart--close"),$closeCart.on("click",hideModal),$cssTransforms||$modalContainer.addClass("no-transforms"),$(window).on({orientationchange:function(){$modalContainer.hasClass("is-visible")&&sizeModal("resize")},resize:function(){!$nojQueryLoad&&$modalContainer.hasClass("is-visible")&&sizeModal("resize")}}),setToggleButtons()},showModal=function(a){$body.addClass("ajaxify-modal--visible"),!cartInit&&a?Shopify.getCart(cartUpdateCallback):sizeModal()},sizeModal=function(a){a||$modalContainer.css("opacity",0),$modalContainer.css({"margin-left":-$modalContainer.outerWidth()/2,opacity:1}),$closeCart.css({top:10+$cartContainer.find("h1").height()/2}),$modalContainer.addClass("is-visible"),scrollTop()},hideModal=function(a){$body.removeClass("ajaxify-modal--visible"),a&&a.preventDefault(),$modalContainer&&($modalContainer.removeClass("is-visible"),$body.removeClass("ajaxify-lock")),toggleCallback({is_visible:!1})},drawerSetup=function(){var a=$("#drawerTemplate").html(),t=Handlebars.compile(a),e={wrapperClass:$wrapperClass};settings.drawerExists||$prependDrawerTo.prepend(t(e)),$drawerContainer=$("#ajaxifyDrawer"),$cartContainer=$("#ajaxifyCart"),$(".ajaxifyCart--close").length||$drawerContainer.prepend('<a class="ajaxifyCart--close" title="Close"><span class="icon-fallback-text"><span class="icon icon-cross" aria-hidden="true"></span><span class="fallback-text">Close</span></span></a>'),$closeCart=$(".ajaxifyCart--close"),$closeCart.on("click",hideDrawer),setToggleButtons()},showDrawer=function(a){"flip"==settings.method?Shopify.getCart(flipCartUpdateCallback):!cartInit&&a&&Shopify.getCart(cartUpdateCallback),$drawerContainer.addClass("is-visible"),$body.addClass("page-move--cart"),setTimeout(function(){$html.addClass("page-move--toggled"),$body.addClass("mobile-drawer--open")},600),$pageWrapper.on("click.mobileDrawerOpen",function(){$body.hasClass("mobile-drawer--open")&&hideDrawer()})},hideDrawer=function(){$drawerContainer.removeClass("is-visible"),$html.removeClass("page-move--toggled"),$body.removeClass("mobile-drawer--open page-move--cart"),toggleCallback({is_visible:!1}),$pageWrapper.off("click.mobileDrawerOpen")},loadCartImages=function(){var a=$("img",$cartContainer),t=a.length,e=0;a.on("load",function(){if(++e==t)switch(settings.method){case"modal":sizeModal()}})},formOverride=function(){$formContainer.submit(function(a){switch(a.preventDefault(),$addToCart.removeClass("is-added").addClass("is-adding"),$(".qty-error").remove(),Shopify.addItemFromForm(a.target,itemAddedCallback,itemErrorCallback),settings.method){case"flip":$flipContainer.addClass("flip--is-loading")}})},itemAddedCallback=function(){switch($addToCart.removeClass("is-adding").addClass("is-added"),settings.method){case"flip":setTimeout(function(){$flipContainer.removeClass("flip--is-loading").addClass("is-flipped")},600)}Shopify.getCart(cartUpdateCallback)},itemErrorCallback=function(XMLHttpRequest,textStatus,form){switch(settings.method){case"flip":$flipContainer.removeClass("flip--is-loading")}var data=eval("("+XMLHttpRequest.responseText+")");data.message&&422==data.status&&$(form).after('<div class="errors qty-error">'+data.description+"</div>")},cartUpdateCallback=function(a){switch(updateCountPrice(a),settings.method){case"flip":$(".flip-cart span").html(a.item_count);break;case"modal":buildCart(a);break;case"drawer":buildCart(a),$drawerContainer.hasClass("is-visible")?scrollTop():showDrawer()}},setToggleButtons=function(){($toggleCartButton=$(settings.toggleCartButton))&&($toggleCartButton.off("click"),$toggleCartButton.on("click",function(a){switch(a.preventDefault(),settings.method){case"modal":$modalContainer.hasClass("is-visible")?hideModal():showModal(!0);break;case"drawer":case"flip":$drawerContainer.hasClass("is-visible")?hideDrawer():showDrawer(!0)}}))},flipCartUpdateCallback=function(a){buildCart(a)},buildCart=function(a){if(settings.useCartTemplate&&0!==a.item_count||$cartContainer.empty(),0!==a.item_count){if(settings.useCartTemplate)return void cartTemplate(a);var t=[],e={},r={},o=$("#cartTemplate").html(),n=Handlebars.compile(o);switch($.each(a.items,function(a,r){var o=r.quantity+1,n=r.quantity-1,i=r.quantity,s=r.image.replace(/(\.[^.]*)$/,"_small$1").replace("http:",""),l=r.title.replace(/(\-[^-]*)$/,""),c=r.title.replace(/^[^\-]*/,"").replace(/-/,"");e={key:r.key,line:a+1,url:r.url,img:s,name:l,variation:c,itemAdd:o,itemMinus:n,itemQty:i,price:Shopify.formatMoney(r.price,settings.moneyFormat)},t.push(e)}),r={items:t,totalPrice:Shopify.formatMoney(a.total_price,settings.moneyFormat),btnClass:$btnClass},$cartContainer.append(n(r)),adjustCart(),settings.method){case"modal":loadCartImages();break;case"flip":case"drawer":a.item_count>0&&loadCartImages()}cartInit=!0}else switch($cartContainer.append('<h2 class="text-center">Your Cart</h2>').append('<p class="cart--empty-message text-center">Your cart is currently empty.</p>').append('<div class="cart--cookie-message text-center"><p>Enable cookies to use the shopping cart</p></div>'),settings.method){case"modal":sizeModal("resize")}},cartTemplate=function(a){$cartContainer.load('/cart form[action="/cart"]',function(){switch(adjustCart(),settings.method){case"modal":loadCartImages();break;case"flip":case"drawer":a.item_count>0&&loadCartImages()}cartInit=!0,toggleCallback({is_visible:!0})})},adjustCart=function(){function a(a,t){var e;e=settings.useCartTemplate?$('.cart__row[data-line="'+a+'"]').addClass("ajaxifyCart--is-loading"):$('.ajaxifyCart--row[data-line="'+a+'"]').addClass("ajaxifyCart--is-loading"),0===t&&e.addClass("is-removed"),setTimeout(function(){Shopify.changeItem(a,t,adjustCartCallback)},250)}settings.useCartTemplate&&createQtySelectors();var t=$(".ajaxifyCart--qty span");t.off("click"),t.on("click",function(){var t=$(this),e=t.data("line"),r=(t.data("id"),t.siblings(".ajaxifyCart--num")),o=r.val()?parseInt(r.val().replace(/\D/g,"")):0,o=validateQty(o);t.hasClass("ajaxifyCart--add")?o+=1:(o-=1)<=0&&(o=0),e?a(e,o):r.val(o)});var e=$(".ajaxifyCart--num");e.off("change"),e.on("change",function(){var t=$(this),e=t.data("line"),r=parseInt(t.val().replace(/\D/g,""));r=validateQty(r),e&&a(e,r)}),e.off("focus"),e.on("focus",function(){var a=$(this);setTimeout(function(){a.select()},50)}),$(".ajaxifyCart--remove").on("click",function(t){var e=$(this),r=e.data("line")||null;r&&(t.preventDefault(),a(r,0))});var r=$('textarea[name="note"]');r.off("change"),r.on("change",function(){var a=$(this).val();Shopify.updateCartNote(a,function(){})}),window.Shopify&&Shopify.StorefrontExpressButtons&&Shopify.StorefrontExpressButtons.initialize()},adjustCartCallback=function(a){if(updateCountPrice(a),0===a.item_count)switch(settings.method){case"modal":break;case"flip":case"drawer":hideDrawer()}setTimeout(function(){Shopify.getCart(buildCart)},150)},createQtySelectors=function(){$('input[type="number"]',$cartContainer).length&&$('input[type="number"]',$cartContainer).each(function(){var a=$(this),t=parseInt(a.val()),e=t+1,r=t-1,o=t,n=$("#ajaxifyQty").html(),i=Handlebars.compile(n),s={key:a.data("id"),line:a.data("line"),itemQty:o,itemAdd:e,itemMinus:r};a.after(i(s)).remove()}),$('a[href^="/cart/change"]',$cartContainer).length&&$('a[href^="/cart/change"]',$cartContainer).each(function(){$(this).addClass("ajaxifyCart--remove")})},qtySelectors=function(){var a=$('input[type="number"]'),t=1;a.length&&(a.each(function(){var a=$(this),t=parseInt(a.val()),e=a.attr("name"),r=a.attr("id"),o=t+1,n=t-1,i=t,s=$("#jsQty").html(),l=Handlebars.compile(s),c={key:a.data("id"),itemQty:i,itemAdd:o,itemMinus:n,inputName:e,inputId:r};a.after(l(c)).remove()}),$(".js--qty-adjuster").off(),$(".js--qty-adjuster").on("click",function(){var a=$(this),e=(a.data("id"),a.siblings(".js--num")),r=parseInt(e.val().replace(/\D/g,"")),r=validateQty(r);$body.hasClass("template-cart")&&(t=0),a.hasClass("js--add")?r+=1:(r-=1)<=t&&(r=t),e.val(r)}))},validateQty=function(a){return(parseFloat(a)!=parseInt(a)||isNaN(a))&&(a=1),a},scrollTop=function(){($body.scrollTop()>0||$html.scrollTop()>0)&&$("html, body").animate({scrollTop:0},250,"swing")},toggleCallback=function(a){a.method=settings.method,"function"==typeof settings.onToggleCallback&&settings.onToggleCallback.call(this,a)},module={init:init}}(ajaxifyShopify||{},jQuery);
